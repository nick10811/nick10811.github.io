---
layout: post
title: How to make a schedule to clean logs on Linux ?
date: '2016-05-09T12:28:00.000+08:00'
author: Nick Yang
tags:
- log
- tmpwatch
- Linux
- crontab
modified_time: '2016-05-18T22:27:51.832+08:00'
blogger_id: tag:blogger.com,1999:blog-7236887784802460774.post-1659578763736826493
blogger_orig_url: https://imjustaprogrammer.blogspot.com/2016/05/how-to-make-schedule-to-clean-logs-on.html
---

<div style="font-family: helvetica; line-height: normal; text-align: justify;"><div style="line-height: normal;"><div style="line-height: normal;"><div style="line-height: normal;"><div style="line-height: normal;"><span style="-webkit-font-kerning: none;">In the software <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="f3f14a7b-2308-413b-b88c-d928ab290231" id="e364597e-5cc0-4961-8d08-ac9465909817"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="f3f14a7b-2308-413b-b88c-d928ab290231" id="e364597e-5cc0-4961-8d08-ac9465909817"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="92ed803d-d328-4434-bc11-a2b8a4241768" id="8f678f69-4b21-47d9-933f-b480737dd509"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="1b0011fe-c228-452b-870e-bf04280751f6" id="ec09c60b-3756-4a18-88cd-615e2ae57bdc"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="7f1d1cfa-56c9-4745-811f-f7ce5cc8db79" id="5d7c26d5-503c-4f7a-a473-ced5570553d6"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="19405991-acd5-4387-bb07-3d32c4725ad4" id="97ca9c0e-06c9-4ee1-bb8c-04f88106fb60"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="8bb04ff0-7fcf-4721-9362-5e2bdbedf19e" id="d366b104-7d38-468e-abc0-82ec22f8d92e">developing</gs></gs></gs></gs></gs></gs></gs>, we may make a lot of logs and stored on our <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="f3f14a7b-2308-413b-b88c-d928ab290231" id="8008d160-7ede-4f21-a9ae-ddc5d4b6eccb"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="f3f14a7b-2308-413b-b88c-d928ab290231" id="8008d160-7ede-4f21-a9ae-ddc5d4b6eccb"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="92ed803d-d328-4434-bc11-a2b8a4241768" id="7ea41dbb-eab8-4408-ae27-60edac732dd4"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="1b0011fe-c228-452b-870e-bf04280751f6" id="d1372b85-caa2-48e6-85fd-6b26142cbf81"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="7f1d1cfa-56c9-4745-811f-f7ce5cc8db79" id="c815cc47-5252-4248-b672-f3504421211d"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="19405991-acd5-4387-bb07-3d32c4725ad4" id="d18df20c-b469-44d0-baaa-8a74bca8983a"><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="8bb04ff0-7fcf-4721-9362-5e2bdbedf19e" id="64a67d86-a24d-4520-9d1c-6eb655985db3">developed</gs></gs></gs></gs></gs></gs></gs> systems. However, logs will increase by the time. To address <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="a8a9a06c-ba5e-46a1-9214-a80d6e885b44" id="de6fd427-4782-499d-9168-bc557d16f255">increasable</gs> logs, we should make a schedule to clean it. In <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="a6cbe5eb-0112-4c30-ab33-96e437ce80e8" id="6339f4f6-a327-4f40-bf4f-201348d2bfc2">Linux system</gs>, we have a simple way to do it. This article will introduce two <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="9c18b8f1-1087-46a3-a6cc-d38a1935ae1f" id="6c01dfe5-8be9-469a-bd0e-37b28f2d0061">commands</gs> which are installed on Linux. First is <b><i><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="eee88b31-a611-492a-8fd4-d002ab941d47" id="6d5434e6-6db6-40d8-9917-a6e5e7d59c98">crontab</gs></i></b>, that is a command which service for you to make a schedule to do something. Second, <b><i><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="8db7cac4-e93b-4a36-a914-20d8bc5f77db" id="fd4b4338-3867-416f-9f04-9b3dd1ff6f5c">tmpwatch</gs></i></b> is a command which cleans <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="8db7cac4-e93b-4a36-a914-20d8bc5f77db" id="02abb373-ef80-4ac9-aaaa-22909379a3b1">tmp directory</gs>. This article illustrates how to use those two commands to achieve our work.</span></div><div style="line-height: normal; min-height: 15px;"><b><i><br /></i></b><b><i><u><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="abecf8a6-3ded-4f9b-859b-0957bbff048b" id="bce739a3-fec2-423a-8b73-0a9ca9e5e75a">crontab</gs></u></i></b><br /><div style="line-height: normal;"><span style="font-kerning: none;">This command makes the work cycle to do it. The <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="d3a19df7-9cc0-42b4-9f60-a69f2a1efcde" id="d145c524-8882-4a90-b9bb-91253f68a8cc">cycler</gs> time use minute, hour, week, month, and year. You can use <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="3c64dd3e-9e34-40cd-83c1-fe8017bb832a" id="104fa66e-f3b7-4f15-8051-2b8f3571cdd7">crontab command</gs> to archive your work, and also edit /etc/<gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="3c64dd3e-9e34-40cd-83c1-fe8017bb832a" id="a904c32e-ec9a-4443-9e1d-ffcdd4078047">crontab</gs> to do it. <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="c7915ea3-eb80-431d-9d75-4605be7f85fd" id="1298febb-4e65-4b6d-8d40-b37bb3008134">To</gs> security issues, /etc/<gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="c7915ea3-eb80-431d-9d75-4605be7f85fd" id="10ff7b99-2654-4a7f-85c6-83c87dec6cc8">cron</gs><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="c7915ea3-eb80-431d-9d75-4605be7f85fd" id="feb27960-91b1-46d0-aed6-8f501472b021">.</gs><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="c7915ea3-eb80-431d-9d75-4605be7f85fd" id="9dd96285-2b89-4443-ab69-326b8b5ce442">allow</gs> <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="c7915ea3-eb80-431d-9d75-4605be7f85fd" id="9ee4225f-6457-468f-9d2e-ec428f0fd1f8">use</gs> to allow who can use this command. Vice versa, /etc/cron.deny use to deny who cannot use it.</span></div><div style="line-height: normal; min-height: 15px;"><span style="font-kerning: none;"></span><br /></div><div style="line-height: normal;"><span style="font-kerning: none;">The <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="b85cfc88-9415-41a3-b2c5-0daddf42cc73" id="aaf02fe6-c03d-49ef-a36e-71e20632cc32">crontab</gs> content</span></div><pre class="brush: bash; gutter: false;">[nick1811@centos-6 ~]$ cat /etc/crontab<br />SHELL=/bin/bash<br />PATH=/sbin:/bin:/usr/sbin:/usr/bin<br />MAILTO=root<br />HOME=/<br /><br /># For details see man 4 crontabs<br /><br /># Example of job definition:<br /># .---------------- minute (0 - 59)<br /># |  .------------- hour (0 - 23)<br /># |  |  .---------- day of month (1 - 31)<br /># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...<br /># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat<br /># |  |  |  |  |<br /># *  *  *  *  * user-name command to be executed<br /></pre><div style="line-height: normal;"><div style="line-height: normal;"><br /></div></div><div style="line-height: normal;"><span style="font-kerning: none;"><b><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="b33e9f65-ba5b-45f7-bebe-fc22cad5d13a" id="d700df53-016c-4613-b80c-0d9cbe57f4cf">parameters</gs>:</b> <a href="http://linux.die.net/man/1/crontab"><span style="-webkit-font-kerning: none;">http://linux.die.net/man/1/crontab</span></a></span></div><div style="line-height: normal; min-height: 15px;"><span style="font-kerning: none;"><b><i></i></b></span><br /><br /></div><div style="line-height: normal;"><span style="font-kerning: none;"><b><i><u><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="aa31712f-6814-4202-b266-7fe4acbf4cce" id="4d071c40-af57-4f9f-9c4e-393cab48507b">tmpwatch</gs></u></i></b></span></div><div style="line-height: normal;"><span style="font-kerning: none;">Temporary files are almost placed in /tmp directory, and be deleted by the system. To <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="1c760ac9-0a23-4aba-84a4-67eb4d96df0d" id="8200be93-982d-478e-92ed-1eb64b318525">assurance</gs> the /tmp directory is not full, the system automatically cleans it in each day. This because the system makes a schedule to execute&nbsp;</span><b><i><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="b6d4b7b1-7df8-4295-b003-7ab1c379c1b3" id="33b09f3b-d695-4e6d-b1aa-aa699f78c824">tmpwatch</gs></i></b> to do it. This package is not installed in minimum installation.</div><div style="line-height: normal; min-height: 15px;"><span style="font-kerning: none;"></span><br /></div><div style="line-height: normal;"><span style="font-kerning: none;">Using <b><i>yum</i></b> to install <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="6964dfb9-47de-4bac-a50a-00c4d4e2f347" id="4722fb3c-d3e1-49c7-b130-3223db4062dd">package</gs>:</span></div><pre class="brush: bash; gutter: false;">[root@centos-6 ~]# yum install tmpwatch.x86_64<br /></pre><div style="line-height: normal;"><br /></div><div style="line-height: normal;"><span style="font-kerning: none;">After installing, the <b><i><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="88376504-9fb7-44ba-944b-d51b532b5339" id="7113ab4f-3aa8-4a20-917f-72d2dcbb7787">tmpwatch</gs></i></b> file will be placed <gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="88376504-9fb7-44ba-944b-d51b532b5339" id="8494914d-d99d-43ae-9c45-389f8fde8dd8">on</gs> this location<gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="88376504-9fb7-44ba-944b-d51b532b5339" id="8a0ee2b3-62a9-4f33-a443-a0e3e36f69b1">( </gs>/etc/<gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="88376504-9fb7-44ba-944b-d51b532b5339" id="5c924a02-9f9c-40e7-a67e-bc0081b963a7">cron</gs><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="88376504-9fb7-44ba-944b-d51b532b5339" id="8050e87f-a7d8-40a6-8e4d-b3e320ca5cce">.</gs>daily). We can use <b><i>cat</i></b> to view it. All files in the <b>/tmp</b> will be deleted when it be not accessed in 30 days. This file shows the system recursively detects /tmp directory and deletes files.</span></div><pre class="brush: bash; gutter: false;">[nick1811@centos-6 ~]$ cat /etc/cron.daily/tmpwatch <br />#! /bin/sh<br />flags=-umc<br />/usr/sbin/tmpwatch "$flags" -x /tmp/.X11-unix -x /tmp/.XIM-unix \<br /> -x /tmp/.font-unix -x /tmp/.ICE-unix -x /tmp/.Test-unix \<br /> -X '/tmp/hsperfdata_*' 10d /tmp<br />/usr/sbin/tmpwatch "$flags" 30d /var/tmp<br />for d in /var/{cache/man,catman}/{cat?,X11R6/cat?,local/cat?}; do<br />    if [ -d "$d" ]; then<br /> /usr/sbin/tmpwatch "$flags" -f 30d "$d"<br />    fi<br />done<br /></pre><div style="line-height: normal;"><br /></div><div style="line-height: normal;"><span style="font-kerning: none;"><b><gs class="GINGER_SOFTWARE_mark" ginger_software_uiphraseguid="a853711c-348b-4d28-8133-b3eab037e065" id="eee487f5-6303-4a6b-9760-9d91bcfcb14a">parameters</gs>:</b> <a href="http://linux.die.net/man/8/tmpwatch"><span style="-webkit-font-kerning: none;">http://linux.die.net/man/8/tmpwatch</span></a></span></div><div style="-webkit-text-stroke-color: rgb(68, 68, 68); -webkit-text-stroke-width: initial; color: #444444; line-height: normal; min-height: 15px;"><span style="font-kerning: none;"></span><br /><br /></div><div style="line-height: normal;"><span style="font-kerning: none;"><b><i><u>How to make a schedule to clean logs?</u></i></b></span></div><div style="line-height: normal;"><span style="font-kerning: none;">Now, we can make our schedule to clean logs. For an instance, we clean a directory at 1:30 in every day, and delete files which be not accessed in a month.</span></div><pre class="brush: bash; gutter: false;">[nick1811@centos-6 ~]$ crontab -e<br /></pre><pre class="brush: bash;"># Example of job definition:<br /># .---------------- minute (0 - 59)<br /># |  .------------- hour (0 - 23)<br /># |  |  .---------- day of month (1 - 31)<br /># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...<br /># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat<br /># |  |  |  |  |<br /># *  *  *  *  * user-name  command to be executed<br /> 30  1  *  *  * /usr/sbin/tmpwatch -maf 30d /home/nick1811/logs<br /></pre><div style="line-height: normal;"><br /></div></div></div></div></div></div>