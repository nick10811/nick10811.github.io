<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <!-- SEO -->
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html">
  <meta name="author" content="Nick Yang">
  <meta name="copyright" content="Nick Yang">
  <meta name="google-site-verification" content="k__3UkuLW0Sii1xTIEMqhQPH9FK0q80vJRUGjaYhpdo" />
  <meta name="keywords"
        content="iOS, Swift, Objective-C, iOS Developer, Mac, watchOS, Linux, imjustaprogrammer, im just a programmer, I'm just a programmer">

  <link rel="start" title="I'm Just A Programmer" href="/">

  
    <meta property="og:title" content="I'm Just A Programmer" >
    <meta property="og:type" content="article" />
    <meta property="og:image" content="/public/logo.png">
    <meta property="og:description"
        content="" >
    <meta name="description"
        content="">
  

  <title>
    
      Introduce the Index of MongoDB &middot; I'm Just A Programmer
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/custom.min.css">
  <link href="/public/css/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


<body class="theme-base-chocolate">
    <div class="navbar">
    <h1>
        <a class="home-logo" href="https://nick10811.github.io">
            I'm Just A Programmer
        </a>
    </h1>

    <nav>
        <a href="/latest_app">Latest Apps</a>
        <a href="/archive">Archives</a>
        <a href="/about">About</a>
        <!-- 
        
            
                
            
        
            
                
                    <a  href="/about/">About</a>
                
            
        
            
                
                    <a  href="/archive/">Archives</a>
                
            
        
            
        
            
                
            
        
            
                
            
        
            
                
                    <a  href="/publication/">Publications</a>
                
            
        
            
                
            
        
            
                
            
        
            
                
                    <a  href="/tags/">Tags</a>
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
         -->
    </nav>
</div>
 <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="https://nick10811.github.io">
          I'm Just A Programmer
        </a>
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/latest_app">Latest Apps</a>
      <a class="sidebar-nav-item" href="/tags">Tags</a>
      <a class="sidebar-nav-item" href="/archive">Archives</a>
      <a class="sidebar-nav-item" href="/about">About</a>
      

      <!-- 
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archives</a>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/publication/">Publications</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/tags/">Tags</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
       -->
      <span class="sidebar-nav-item">
        <ul class="list-inline text-center">
          
          <li>
              <a href="https://www.linkedin.com/in/nick10811">
                  <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-linkedin fa-stack-1x"></i>
                  </span>
              </a>
          </li>
          
          
          <li>
              <a href="https://github.com/nick10811">
                  <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-github fa-stack-1x"></i>
                  </span>
              </a>
          </li>
          
          
          <li>
            <a href="https://twitter.com/nick10811_">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
              </span>
            </a>
          </li>
          
        </ul>
      </span>
    </nav>
    <p class="copyright">
        &copy; Copyright 2024 | Nick Yang | All rights reserved
    </p>
  </div>
</div>

    <div class="content container">
        <div class="post">
  <h1 class="post-title">Introduce the Index of MongoDB</h1>
  <span class="post-date">17 May 2024</span>
  <h2 id="what-are-indexes-for">What are indexes for</h2>

<p>The primary function of indexes is to improve the performance of queries and update/sort operations. For instance, when searching for all pages in a book containing a certain word or phrase, you can refer to the index to quickly locate the associated page numbers. The index provides a quick way to find the information you need without having to read the entire book.</p>

<p>Similarly, a MongoDB index stores a small portion of the data set in an easy-to-traverse form. Without indexes, the database engine must scan every document in a collection to return query results. This can be slow and resource-intensive, especially for large collections.</p>

<h2 id="prefix-compression">Prefix Compression</h2>

<p>Index prefix compression deduplicates common prefixes in a compound index. It can reduce memory and disk space requirements for indexes. MongoDB uses prefix compression on all indexes, including single-key indexes.</p>

<p><img src="https://devopedia.org/images/article/159/6930.1553271271.jpg" alt="prefix encoding" /></p>

<p>ref: <a href="https://devopedia.org/database-compression">https://devopedia.org/database-compression</a></p>

<h2 id="misconceptions">Misconceptions</h2>

<h3 id="mongodb-is-so-fast-that-it-doesnt-need-indexes">MongoDB is so fast that it doesn’t need indexes</h3>

<p>MongoDB is fast, but it’s not magic. Indexes are still important for performance. Without indexes, MongoDB must perform a collection scan.</p>

<blockquote>
  <p><strong>INFO</strong> The query is fast enough if the data is less than 10,000 records.</p>
</blockquote>

<h3 id="every-field-is-automatically-indexed">Every field is automatically indexed</h3>

<p>MongoDB automatically creates an index on the <code class="language-plaintext highlighter-rouge">_id</code> field. You can also create indexes on other fields to improve query performance. Not all fields are indexed by default, so it is essential to create indexes on fields you query often.</p>

<p>In an ideal scenario, all fields would be indexed, but this can consume a lot of memory and disk space while also slowing down write operations. It’s important to balance the benefits of indexing with the costs.</p>

<blockquote>
  <p><strong>HINT</strong> Up to 64 indexes per collection is allowed. 4 indexes per collection is a good rule of thumb.</p>
</blockquote>

<h3 id="nosql-uses-hashes-instead-of-indexes">NoSQL uses hashes instead of indexes</h3>

<p>NoSQL databases like MongoDB use indexes to improve query performance.</p>

<h2 id="index-types">Index Types</h2>

<p>MongoDB provides several types of indexes to support specific types of queries and data models. Indexes can be created on any field in a document, including fields within arrays. MongoDB provides the following types of indexes:</p>

<ul>
  <li>Single Field</li>
  <li>Multikey</li>
  <li>Compound</li>
  <li>Text</li>
  <li>Hashed</li>
  <li>…</li>
</ul>

<h3 id="single-field">Single Field</h3>

<p>Single Field indexes store information from a single field in a collection. By default, MongoDB creates a unique index on the <code class="language-plaintext highlighter-rouge">_id</code> field in every collection. You can also create single field indexes on other fields in a collection to speed up important queries and operations.</p>

<h4 id="create-a-single-field-index">Create a Single Field Index</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">field</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">sortOrder</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p><strong>HINT</strong> <code class="language-plaintext highlighter-rouge">sortOrder</code> can be either <code class="language-plaintext highlighter-rouge">1</code> for ascending or <code class="language-plaintext highlighter-rouge">-1</code> for descending.</p>
</blockquote>

<h3 id="multikey">Multikey</h3>

<p>Multikey indexes are indexes on arrays. When you create an index on a field that contains an array value, MongoDB automatically creates a multikey index. If an array field contains multiple instances of the same value, the index will store the value only once.</p>

<h4 id="create-a-multikey-index">Create a Multikey Index</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">arrayField</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">sortOrder</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></div></div>

<h3 id="compound">Compound</h3>

<p>Compound indexes index from two or more fields in each document in a collection. This is the most common index type in MongoDB. While it is often to use 3 or 4 fields in a compound index, MongoDB supports up to 32 fields in a compound index. It is similar to a single field index, but it can improve query performance for queries that use multiple fields. It is important to note that the order of the fields in a compound index matters.</p>

<h4 id="create-a-compound-index">Create a Compound Index</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span> <span class="p">{</span> 
    <span class="o">&lt;</span><span class="nx">field1</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">sortOrder1</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="o">&lt;</span><span class="nx">field2</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">sortOrder2</span><span class="o">&gt;</span> 
<span class="p">}</span> <span class="p">)</span>
</code></pre></div></div>

<h4 id="esr-principle">ESR Principle</h4>

<p>The ESR principle is a good rule of thumb for creating compound indexes. It stands for Equality, Sort, and Range. When creating a compound index, you should consider the following:</p>

<ul>
  <li><strong>Equality</strong>: Fields that are used in equality queries should come first in the index.</li>
  <li><strong>Sort</strong>: Fields that are used in sort queries should come next in the index.</li>
  <li><strong>Range</strong>: Fields that are used in range queries should come last in the index.</li>
</ul>

<blockquote>
  <p>Example:
We want to query Alice’s lastest month’s login records.
1st. it should match the user name, Alice.
2nd. it should sort the records by the login time.
3th. it should find the records in the lastest month.</p>
</blockquote>

<h3 id="text">Text</h3>

<p>Text indexes support full-text search of string content. Text indexes can include any field whose value is a string or an array of string elements.</p>

<h4 id="create-a-text-index">Create a Text Index</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span> <span class="p">{</span> 
    <span class="o">&lt;</span><span class="nx">field1</span><span class="o">&gt;</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text 1</span><span class="dl">"</span><span class="p">,</span>
    <span class="o">&lt;</span><span class="nx">field2</span><span class="o">&gt;</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text 2</span><span class="dl">"</span><span class="p">,</span> 
<span class="p">}</span> <span class="p">)</span>
</code></pre></div></div>

<h3 id="hashed">Hashed</h3>

<p>Hashed indexes index a 20 byte md5 of the BSON value. It can potentially reduce index size if original values are large.</p>

<blockquote>
  <p><strong>DOWNSIDE</strong> radom values in a BTree use excessive resources.</p>
</blockquote>

<h4 id="create-a-hashed-index">Create a Hashed Index</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">field</span><span class="o">&gt;</span><span class="p">:</span> <span class="dl">"</span><span class="s2">hashed</span><span class="dl">"</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></div></div>

<h2 id="performance">Performance</h2>

<p>Indexes can improve read performance when used. However, each index adds ~10% overhead to write (insert, delete, update) operations. (Hashed indexes, multikey indexes, text indexes, and wildcard indexes can add more overhead.)</p>

<h3 id="explain"><code class="language-plaintext highlighter-rouge">explain()</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">explain()</code> method provides information on the query plan and index usage. You can use the <code class="language-plaintext highlighter-rouge">explain()</code> method to analyze query performance and optimize indexes.</p>

<h4 id="example">Example</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">query</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">).</span><span class="nx">explain</span><span class="p">(</span><span class="dl">'</span><span class="s1">executionStats</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="use-indexes-with-care">Use Indexes with Care</h2>

<ul>
  <li><strong>Use Indexes to Support Queries</strong>: Indexes can improve query performance, but they can also slow down write operations. Use indexes to support queries that are important to your application.</li>
  <li><strong>Avoid Over-Indexing</strong>: Indexes consume memory and disk space. Avoid creating indexes on fields that are rarely queried.</li>
  <li><strong>Monitor Index Usage</strong>: Use the <code class="language-plaintext highlighter-rouge">explain()</code> method to monitor index usage and query performance. Optimize indexes based on query performance.</li>
</ul>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://docs.mongodb.com/manual/indexes/">Indexes</a></li>
  <li><a href="https://www.mongodb.com/resources/basics/databases/database-index">What is indexing in a Database</a></li>
  <li><a href="https://devopedia.org/database-compression">Database Compression</a></li>
  <li><a href="https://www.sciencedirect.com/topics/mathematics/prefix-code#:~:text=In%20other%20words%2C%20a%20prefix,bits%20to%20a%20shorter%20codeword.">Prefix Code</a></li>
  <li><a href="https://www.mongodb.com/docs/manual/reference/command/explain/">explain()</a></li>
</ul>

  <div class="post-tag">
    <span class="fa-stack fa-sm">
      <i class="fa fa-tags fa-stack-1x"></i>
    </span>
    :  <a class="tag-wrapper" href="/tags/MongoDB" title="View posts tagged with &quot;MongoDB&quot;"><span class="tags">MongoDB</span></a>    <a class="tag-wrapper" href="/tags/Indexes" title="View posts tagged with &quot;Indexes&quot;"><span class="tags">Indexes</span></a>   
  </div>
</div>

<div class="message">
  <img class="profile" src="/public/profile.png" alt="profile-image">
  <div class="intro-message" style="text-align:justify">
    Hello, My name is Nick, Taiwanese🇹🇼. I like to develop iOS Apps and use Unix-based operating systems. And, I love reading and
    traveling to fill to my life. This blog recorded all technical articles which I have faced and solved problems. Please
    leave your comment to discuss with me.
  </div>
</div>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2023/01/19/in-app-purchase/">
            In-App Purchase (IAP)
            <small>19 Jan 2023</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2022/12/17/Automate-the-iOS-App-Development-and-Release-Process-with-Fastlane/">
            Automate the iOS App Development and Release Process with Fastlane
            <small>17 Dec 2022</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2022/03/05/Daemon-programming-on-macOS/">
            Daemon programming on macOS
            <small>05 Mar 2022</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>
 
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'nick10811'; // required: replace example with your forum shortname
    var disqus_identifier = '/2024/05/17/introduce-the-index-of-mongodb/';
    var disqus_url = 'https://nick10811.github.io/2024/05/17/introduce-the-index-of-mongodb/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>
    <script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'nick10811'; // required: replace example with your forum shortname
var disqus_identifier = '/2024/05/17/introduce-the-index-of-mongodb/';
var disqus_url = 'https://nick10811.github.io/2024/05/17/introduce-the-index-of-mongodb/';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var s = document.createElement('script');
    s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59285222-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
window.fbAsyncInit = function() {
    FB.init({
        appId: '636566956443735',
        xfbml: true,
        version: 'v2.3'
    });
};

(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) {
        return;
    }
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>

</html>
