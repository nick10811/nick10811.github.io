<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <!-- SEO -->
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html">
  <meta name="author" content="Nick Yang">
  <meta name="copyright" content="Nick Yang">
  <meta name="google-site-verification" content="k__3UkuLW0Sii1xTIEMqhQPH9FK0q80vJRUGjaYhpdo" />
  <meta name="keywords"
        content="iOS, Swift, Objective-C, iOS Developer, Mac, watchOS, Linux, imjustaprogrammer, im just a programmer, I'm just a programmer">

  <link rel="start" title="I'm Just A Programmer" href="/">

  
    <meta property="og:title" content="I'm Just A Programmer" >
    <meta property="og:type" content="article" />
    <meta property="og:image" content="/public/logo.png">
    <meta property="og:description"
        content="" >
    <meta name="description"
        content="">
  

  <title>
    
      Automate the iOS App Development and Release Process with Fastlane &middot; I'm Just A Programmer
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/custom.min.css">
  <link href="/public/css/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


<body class="theme-base-chocolate">
    <div class="navbar">
    <h1>
        <a class="home-logo" href="https://nick10811.github.io">
            I'm Just A Programmer
        </a>
    </h1>

    <nav>
        <a href="/latest_app">Latest Apps</a>
        <a href="/archive">Archives</a>
        <a href="/about">About</a>
        <!-- 
        
            
                
            
        
            
                
                    <a  href="/about/">About</a>
                
            
        
            
                
                    <a  href="/archive/">Archives</a>
                
            
        
            
        
            
                
            
        
            
                
            
        
            
                
                    <a  href="/publication/">Publications</a>
                
            
        
            
                
            
        
            
                
            
        
            
                
                    <a  href="/tags/">Tags</a>
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
        
            
                
            
         -->
    </nav>
</div>
 <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="https://nick10811.github.io">
          I'm Just A Programmer
        </a>
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/latest_app">Latest Apps</a>
      <a class="sidebar-nav-item" href="/tags">Tags</a>
      <a class="sidebar-nav-item" href="/archive">Archives</a>
      <a class="sidebar-nav-item" href="/about">About</a>
      

      <!-- 
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archives</a>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/publication/">Publications</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/tags/">Tags</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
       -->
      <span class="sidebar-nav-item">
        <ul class="list-inline text-center">
          
          <li>
              <a href="https://www.linkedin.com/in/nick10811">
                  <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-linkedin fa-stack-1x"></i>
                  </span>
              </a>
          </li>
          
          
          <li>
              <a href="https://github.com/nick10811">
                  <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-github fa-stack-1x"></i>
                  </span>
              </a>
          </li>
          
          
          <li>
            <a href="https://twitter.com/nick10811_">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
              </span>
            </a>
          </li>
          
        </ul>
      </span>
    </nav>
    <p class="copyright">
        &copy; Copyright 2023 | Nick Yang | All rights reserved
    </p>
  </div>
</div>

    <div class="content container">
        <div class="post">
  <h1 class="post-title">Automate the iOS App Development and Release Process with Fastlane</h1>
  <span class="post-date">17 Dec 2022</span>
  <p>As an iOS developer, we need to archive our app for App Store submission. It’s a boring and repetitive task. There are many steps to do it. We need to open Xcode, select the right scheme, select the right certificate, select the right provisioning profile, select the right team, select the right device, and then archive it. It’s a lot of steps. To make it easier, we absolute can write a shell script instead of the IDE operation. But it contains many commands and arguments. It’s not easy to write and maintain. So I choose to use Fastlane to do it. It’s a tool to automate building, testing and releasing iOS and Android apps. The rest of this article will show you how to use Fastlane to facilitate the iOS app archiving process.</p>

<h2 id="install-fastlane">Install Fastlane</h2>
<p>If you are familiar with Mac, you might know that we can install Fastlane with Homebrew. If you don’t know Homebrew, you can check out the <a href="https://brew.sh/">Homebrew website</a>. In this article, we install Fastlane with Homebrew. You can follow the commands below to install Fastlane.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xcode-select <span class="nt">--install</span>
<span class="nv">$ </span>brew <span class="nb">install </span>fastlane

<span class="c"># for M1/M2 users</span>
<span class="nv">$ </span><span class="nb">arch</span> <span class="nt">-x86_64</span> brew <span class="nb">install </span>fastlane

</code></pre></div></div>

<h2 id="init-fastlane">Init Fastlane</h2>
<p>Is it easy right? As an iOS developer, we already know how to create a new project. After you create a new project, you can use the command below to initiate Fastlane.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>fastlane init
</code></pre></div></div>

<p>After you run the command, you will see the following screen. You can choose the option you want. Fastlane is a friendly tool. It will help you to set up everything you need, such as bundle ID and Apple ID. In this article, we choose option 4. It is a manual setup.</p>

<p><img src="/public/fastlane/fastlane_init.jpg" alt="fastlane init" /></p>

<h2 id="configuration">Configuration</h2>
<p>Fastlane will generate a directory named <code class="language-plaintext highlighter-rouge">fastlane</code> in your project. It contains some files and directories. You can see the directory structure below. The basic settings are in the <code class="language-plaintext highlighter-rouge">Appfile</code> and <code class="language-plaintext highlighter-rouge">Fastfile</code>. The <code class="language-plaintext highlighter-rouge">Matchfile</code> is used to manage certificates and provisioning profiles. The <code class="language-plaintext highlighter-rouge">test_output</code> directory contains the test reports in HTML and JUnit format. The <code class="language-plaintext highlighter-rouge">screenshots</code> directory contains the screenshots for App Store purposes.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Project
├── FastlaneDemo/
├── fastlane/
│   ├── Appfile <span class="o">(</span>App environments<span class="o">)</span>
│   ├── Fastfile <span class="o">(</span>Fastlane scripts<span class="o">)</span>
│   ├── Matchfile <span class="o">(</span>Certificates and provisioning profiles<span class="o">)</span>
│   ├── README.md <span class="o">(</span>automatically generated<span class="o">)</span>
│   ├── report.xml
│   ├── test_output/ <span class="o">(</span><span class="nb">test </span>results<span class="o">)</span>
│   │   ├── report.junit
│   │   └── report.html
│   └── screenshots/
├── Gemfile
└── Gemfile.lock
</code></pre></div></div>

<h3 id="appfile">Appfile</h3>
<p>You could follow up the command below to set up the <code class="language-plaintext highlighter-rouge">Appfile</code>. It contains the basic information of your app. You already know the bundle identifier. You can find the team ID in the Developer Portal. It will be used on the upload to the App Store step. It is highly suggested that you should create a DevOps account as the Apple ID for CI/CD purposes instead of yours.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># The bundle identifier of your app</span>
app_identifier<span class="o">(</span><span class="s2">"com.org.fastlane-demo"</span><span class="o">)</span>

<span class="c"># Developer Portal Team ID</span>
team_id<span class="o">(</span><span class="s2">"xxxxxxxxxx"</span><span class="o">)</span>

<span class="c"># Your Apple email address (DevOps account)</span>
apple_id<span class="o">(</span><span class="s2">"your@email.com"</span><span class="o">)</span>
</code></pre></div></div>

<h3 id="fastfile">Fastfile</h3>
<p>This is Fastlane script file. It contains the lanes. The lanes are the steps to build, test, and release your app.</p>

<h4 id="function-test">Function Test</h4>
<p>As a senior iOS developer, we use to write unit tests for our app to assure quality. It is an easy way to run the unit test by using Fastlane. The script below will run the unit test in the <code class="language-plaintext highlighter-rouge">FastlaneDemoTests</code> target. The <code class="language-plaintext highlighter-rouge">run_tests</code> is the Fastlane command to run the unit test. You can find it in the <a href="https://docs.fastlane.tools/getting-started/ios/running-tests/">Fastlane document</a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>desc <span class="s2">"Function Tests"</span>
lane :tests <span class="k">do
  </span>run_tests<span class="o">(</span>scheme: <span class="s2">"FastlaneDemo"</span>,
            only_testing: <span class="o">[</span><span class="s2">"FastlaneDemoTests/FastlaneDemoTests"</span><span class="o">]</span>
  <span class="o">)</span>
end
</code></pre></div></div>

<p>After you write the script, you can perform the command below on the terminal to run the unit test.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>fastlane tests
</code></pre></div></div>

<p>The kindful tool, Fastlane, will help you to generate a test report that is like the following image. You can see it in the <code class="language-plaintext highlighter-rouge">fastlane/test_output/report.html</code>. It is a HTML file. You can open it in the browser. It is easy to read and understand.</p>

<p><img src="/public/fastlane/fastlane_test_report.jpg" alt="fastlane test report" /></p>

<h4 id="beta-release">Beta Release</h4>
<p>There are several tedious tasks during uploading to TestFlight. This is the time to use Fastlane to work best for us. The script below will help you archive the app and upload it to TestFlight. You can find it in the <a href="https://docs.fastlane.tools/actions/upload_to_testflight/">Fastlane document</a>.</p>

<p>However, there are some tips you need to know.</p>
<ul>
  <li>For security reasons, Apple force developers to adopt 2-factor authentication during uploading codes. But we <strong>have to skip it</strong> during CI/CD processing. Hence, you should find <a href="https://support.apple.com/en-us/HT204397#:~:text=App-specific%20passwords%20allow%20you,that%20you%20store%20in%20iCloud.">app-specific passwords</a> on <a href="https://appleid.apple.com/account/home">appleid.apple.com</a> and set it to your environment variable,  <code class="language-plaintext highlighter-rouge">ENV["FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD"]</code>.</li>
  <li>If you integrate <a href="https://docs.fastlane.tools/actions/match/#match">match</a> to manage the certificates and provisioning profiles, you could use <code class="language-plaintext highlighter-rouge">get_certificates</code> and <code class="language-plaintext highlighter-rouge">get_provisioning_profile</code> to get the certificates and provisioning profiles. You can find it in the <a href="https://docs.fastlane.tools/actions/get_certificates/">Fastlane document</a>. It will help you to skip the manual operation to select the right certificate and provisioning profile. But in this article, I already install the certificates and provisioning profiles on my local Mac. Hence, I use <code class="language-plaintext highlighter-rouge">unlock_keychain</code>.</li>
  <li>It is a best practice to avoid storing credentials in the source code or git repository. In my case, the Fastlane script will receive the credential from the environment variable I already set on the local Mac.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>desc <span class="s2">"Beta Release"</span>
lane :beta <span class="k">do</span>

<span class="c"># skip 2 factor authentication</span>
ENV[<span class="s2">"FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD"</span><span class="o">]</span> <span class="o">=</span> ENV[<span class="s2">"APP_SPECIFIED_PASSWORD"</span><span class="o">]</span>

<span class="c">#  increment_build_number</span>
<span class="c">#  get_certificates</span>
<span class="c">#  get_provisioning_profile</span>

  unlock_keychain<span class="o">(</span>
    path: ENV[<span class="s2">"KEYCHAIN_PATH"</span><span class="o">]</span>, <span class="c"># path of keychain</span>
    password: ENV[<span class="s2">"KEYCHAIN_PASSWORD"</span><span class="o">]</span> <span class="c"># Mac password</span>
  <span class="o">)</span>
  build_app<span class="o">(</span>scheme: <span class="s2">"FastlaneDemo"</span>,
            clean: <span class="nb">true</span>,
            silent: <span class="nb">true</span>,
            export_method: <span class="s2">"app-store"</span>,
            export_xcargs: <span class="s2">"-allowProvisioningUpdates"</span>,
            include_bitcode: <span class="nb">true</span>
  <span class="o">)</span>
  upload_to_testflight<span class="o">(</span>skip_submission: <span class="nb">true</span>,
                       skip_waiting_for_build_processing: <span class="nb">true</span>,
                       apple_id: <span class="s2">"000000000"</span> <span class="c"># on the App Store Connect</span>
  <span class="o">)</span>
end
</code></pre></div></div>

<p>If you set up the environment variable correctly, you can perform the command below on the terminal to upload the app to TestFlight.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">APP_SPECIFIED_KEY</span><span class="o">=</span><span class="s2">"XXXX"</span> <span class="se">\</span>
<span class="nb">export </span><span class="nv">KEYCHAIN_PATH</span><span class="o">=</span><span class="s2">"/Users/nick10811/Library/Keychains/login.keychain-db"</span> <span class="se">\</span>
<span class="nb">export </span><span class="nv">KEYCHAIN_PASSWORD</span><span class="o">=</span><span class="s2">"XXXX"</span>
<span class="nv">$ </span>fastlane beta
</code></pre></div></div>

<h2 id="conclusions">Conclusions</h2>
<p>This article only briefly the common commands I used. There are many other useful commands I do not cover in this article. Such as certificate management, auto-submission, auto-screen-shots, and so on. You can find more information in the <a href="https://docs.fastlane.tools/">Fastlane document</a> to empower your CI/CD process. Finally, I give some suggestions to you. I very much recommend you use Fastlane if you are an independent developer or a small team. It will save you a lot of time and effort during the process of development and release. But if you are a big team, you should consider performing original commands, <code class="language-plaintext highlighter-rouge">xcodebuild</code> instead of using Fastlane. Fastlane is an interface of original commands. It is easy to use but it is not flexible. It does not support new arguments, such as <code class="language-plaintext highlighter-rouge">build-for-testing</code> and <code class="language-plaintext highlighter-rouge">test-without-building</code>. Hence, you should consider using original commands to perform the CI/CD process.</p>

<h2 id="references">References</h2>
<ul>
  <li><a href="https://fastlane.tools/">Fastlane</a></li>
  <li><a href="https://support.apple.com/en-us/HT204397#:~:text=App-specific%20passwords%20allow%20you,that%20you%20store%20in%20iCloud.">Sign in to apps with your Apple ID using app-specific passwords</a></li>
  <li><a href="https://medium.com/macoclock/fastlane-in-swift-quick-start-bb4272405a0">https://medium.com/macoclock/fastlane-in-swift-quick-start-bb4272405a0</a></li>
  <li><a href="https://www.appcoda.com.tw/continuous-delivery/">https://www.appcoda.com.tw/continuous-delivery/</a> (Chinese)</li>
</ul>

  <div class="post-tag">
    <span class="fa-stack fa-sm">
      <i class="fa fa-tags fa-stack-1x"></i>
    </span>
    :  <a class="tag-wrapper" href="/tags/iOS" title="View posts tagged with &quot;iOS&quot;"><span class="tags">iOS</span></a>    <a class="tag-wrapper" href="/tags/Fastlane" title="View posts tagged with &quot;Fastlane&quot;"><span class="tags">Fastlane</span></a>    <a class="tag-wrapper" href="/tags/CI/CD" title="View posts tagged with &quot;CI/CD&quot;"><span class="tags">CI/CD</span></a>   
  </div>
</div>

<div class="message">
  <img class="profile" src="/public/profile.png" alt="profile-image">
  <div class="intro-message" style="text-align:justify">
    Hello, My name is Nick, Taiwanese🇹🇼. I like to develop iOS Apps and use Unix-based operating systems. And, I love reading and
    traveling to fill to my life. This blog recorded all technical articles which I have faced and solved problems. Please
    leave your comment to discuss with me.
  </div>
</div>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2023/01/19/in-app-purchase/">
            In-App Purchase (IAP)
            <small>19 Jan 2023</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2022/03/05/Daemon-programming-on-macOS/">
            Daemon programming on macOS
            <small>05 Mar 2022</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2022/02/22/Advanced-Git-make-git-tree-pretty/">
            Advanced Git: make git tree pretty
            <small>22 Feb 2022</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>
 
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'nick10811'; // required: replace example with your forum shortname
    var disqus_identifier = '/2022/12/17/Automate-the-iOS-App-Development-and-Release-Process-with-Fastlane/';
    var disqus_url = 'https://nick10811.github.io/2022/12/17/Automate-the-iOS-App-Development-and-Release-Process-with-Fastlane/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>
    <script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'nick10811'; // required: replace example with your forum shortname
var disqus_identifier = '/2022/12/17/Automate-the-iOS-App-Development-and-Release-Process-with-Fastlane/';
var disqus_url = 'https://nick10811.github.io/2022/12/17/Automate-the-iOS-App-Development-and-Release-Process-with-Fastlane/';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var s = document.createElement('script');
    s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59285222-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
window.fbAsyncInit = function() {
    FB.init({
        appId: '636566956443735',
        xfbml: true,
        version: 'v2.3'
    });
};

(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) {
        return;
    }
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>

</html>
